/**
 * 
 */
package gvprojects.chess.presenter;

import gvprojects.chess.model.IChessPiece;
import gvprojects.chess.model.Model;
import gvprojects.chess.model.Move;
import gvprojects.chess.view.View;

/**
 * @author Justin Rohr
 * 
 */
public class Presenter {

	private Model engine;
	private View view;
	private Move m;

	public Presenter(Model e, View v) {
		engine = e;
		view = v;
		game();
	}

	private void game() {
		boolean move;
		Move m = new Move(0, 0, 0, 0);
		view.print("Welcome to the Game of Chess! \nTo move enter in spots like A1:A2.");
		do {
			view.printBoard();
			do {
				String str = view.getMove();
				if (str.length() == 5) {
					move = true;
					if (validateMove(str.charAt(0) - 65) == true)
						m.fromRow = (str.charAt(0) - 65);
					else
						move = false;
					if (validateMove(str.charAt(1) - 49) == true)
						m.fromColumn = str.charAt(1) - 49;
					else
						move = false;
					if (validateMove(str.charAt(3) - 65) == true)
						m.toRow = str.charAt(3) - 65;
					else
						move = false;
					if (validateMove(str.charAt(4) - 49) == true)
						m.toColumn = str.charAt(4) - 49;
					else
						move = false;
					if (move != false)
						move(m);
				} else {
					view.print("Invalid Move. Please try again");
					move = false;
				}
			} while (move == false);
		} while (engine.isComplete() == false);

	}

	// Validates that a move is on the board from the string to int conversion
	private boolean validateMove(int i) {
		return i < 8 && i > -1;
	}

//	/**
//	 * 
//	 * @param r
//	 * @param c
//	 * @return
//	 */
//	public IChessPiece pieceLoc(int r, int c) {
//		return engine.pieceAt(r, c);
//	}

	/**
	 * Completes a players move by validating and moving the piece. If there is
	 * an error or the piece can't move it prints the problem to the player
	 * 
	 * @param m
	 *            the move to attempt to be completed
	 */
	public void move(Move m) {
		try {
			if (engine.isValidMove(m))
				engine.move(m);
			else
				view.print("Not a valid position to move to!");
		} catch (IllegalArgumentException e) {
			view.print("Invalid Move.Please try again.");
		}
	}

	/**
	 * Main method to create run a chess game
	 * 
	 * @param args
	 *            user specifications for the game --not used
	 */
	public static void main(String[] args) {
		Model e = new Model();
		View v = new View(e);

		new Presenter(e, v);
	}

}
